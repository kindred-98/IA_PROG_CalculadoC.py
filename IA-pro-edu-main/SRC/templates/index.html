<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>AdCalSci</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<!-- =======================================================
     üîù NAVBAR SUPERIOR (Nombre app + Auth usuario)
======================================================= -->
<div class="navbar">

    <!-- Nombre de la aplicaci√≥n -->
    <div class="navbar-left">
        <strong>AdCalSci</strong>
    </div>

    <!-- Estado de sesi√≥n -->
    <div class="navbar-right">
        {% if usuario %}
            <!-- Si est√° logueado -->
            Bienvenido, <strong>{{ usuario.username }}</strong> |
            <a href="{{ url_for('main.logout') }}">Logout</a>
        {% else %}
            <!-- Si NO est√° logueado -->
            <a href="#" onclick="abrirLogin()">Login</a>
            <a href="#" onclick="abrirRegister()">Register</a>
        {% endif %}
    </div>

</div>


<!-- =======================================================
     üßÆ CONTENEDOR PRINCIPAL CALCULADORA
======================================================= -->
<div class="app">

    <!-- Barra superior interna -->
    <div class="top-bar">
        <h2>AdCalSci</h2>

        <!-- Bot√≥n que abre el historial lateral -->
        <button class="btn-historial" onclick="abrirHistorial()">
            Historial ‚ñº
        </button>
    </div>


    <!-- =======================================================
         üñ• DISPLAY (Pantalla resultado)
    ======================================================= -->
    <div class="display-box">
        <div class="display">
            {{ valor_display if valor_display else "0" }}
        </div>
    </div>


    <!-- =======================================================
         üì§ FORM OCULTO (Env√≠a datos al backend)
    ======================================================= -->
    <form method="POST" id="calc-form">
        <input type="hidden" name="num1" id="num1">
        <input type="hidden" name="num2" id="num2">
        <input type="hidden" name="operacion" id="operacion">
    </form>


    <!-- =======================================================
         üî¢ BOTONERA CALCULADORA
    ======================================================= -->
    <div class="botones">

        <!-- Fila 1 -->
        <button class="clear" onclick="limpiar()">C</button>
        <button onclick="operar('/')">√∑</button>
        <button onclick="operar('*')">√ó</button>
        <button onclick="borrar()">‚å´</button>

        <!-- Fila 2 -->
        <button onclick="agregar('7')">7</button>
        <button onclick="agregar('8')">8</button>
        <button onclick="agregar('9')">9</button>
        <button class="op" onclick="operar('-')">‚àí</button>

        <!-- Fila 3 -->
        <button onclick="agregar('4')">4</button>
        <button onclick="agregar('5')">5</button>
        <button onclick="agregar('6')">6</button>
        <button class="op" onclick="operar('+')">+</button>

        <!-- Fila 4 -->
        <button onclick="agregar('1')">1</button>
        <button onclick="agregar('2')">2</button>
        <button onclick="agregar('3')">3</button>
        <button class="igual" onclick="calcular()">=</button>

        <!-- Fila 5 -->
        <button onclick="agregar('0')">0</button>
        <button onclick="agregar('.')">.</button>
        <button onclick="cientifica('sin')">sin</button>
        <button onclick="cientifica('cos')">cos</button>

        <!-- Fila 6 -->
        <button onclick="cientifica('log')">log</button>
        <button onclick="cientifica('‚àö')">‚àö</button>
        <button onclick="cientifica('^')">x ∏</button>
        <button onclick="cientifica('exp')">exp</button>

    </div>

</div>


<!-- =======================================================
     üìú HISTORIAL LATERAL (SIDEBAR DESLIZANTE)
======================================================= -->
<div id="historialSidebar" class="historial-sidebar">

    <!-- Cabecera del historial -->
    <div class="historial-header">
        <h3>Historial</h3>
        <!-- Bot√≥n cerrar -->
        <button onclick="cerrarHistorial()">‚úï</button>
    </div>

    <!-- Lista de operaciones -->
    <ul>
        {% for op in historial %}
            <li>{{ op.expresion }} = {{ op.resultado }}</li>
        {% else %}
            <li>No hay operaciones a√∫n</li>
        {% endfor %}
    </ul>

    <!-- Bot√≥n borrar historial -->
    <form method="POST" action="{{ url_for('main.borrar_historial') }}">
        <button type="submit" class="btn-borrar">Borrar historial</button>
    </form>

</div>


<!-- =======================================================
     üîê MODALES LOGIN / REGISTER
======================================================= -->

<!-- LOGIN -->
<div id="loginModal" class="modal oculto">
    <div class="modal-content">
        <h3>Iniciar sesi√≥n</h3>
        <form method="POST" action="{{ url_for('main.login') }}">
            <input type="email" name="email" placeholder="Email" required>
            <input type="password" name="password" placeholder="Contrase√±a" required>
            <button type="submit">Entrar</button>
        </form>
        <button onclick="cerrarModal()">Cerrar</button>
    </div>
</div>

<!-- REGISTER -->
<div id="registerModal" class="modal oculto">
    <div class="modal-content">
        <h3>Crear cuenta</h3>
        <form method="POST" action="{{ url_for('main.register') }}">
            <input type="text" name="username" placeholder="Username" required>
            <input type="email" name="email" placeholder="Email" required>
            <input type="password" name="password" placeholder="Contrase√±a" required>
            <button type="submit">Registrarse</button>
        </form>
        <button onclick="cerrarModal()">Cerrar</button>
    </div>
</div>


<!-- =======================================================
     üß† JAVASCRIPT
======================================================= -->
<script>

/* =====================================================
   üßÆ L√ìGICA DE LA CALCULADORA
===================================================== */

let num1 = "";
let num2 = "";
let operacion = "";
let segundo = false;

/* A√±ade n√∫meros */
function agregar(n) {
    if (!segundo) {
        num1 += n;
    } else {
        num2 += n;
    }
    actualizarPantalla();
}

/* Selecciona operador */
function operar(op) {
    if (num1 === "") return;
    operacion = op;
    segundo = true;
    actualizarPantalla();
}

/* Actualiza display */
function actualizarPantalla() {
    let texto = num1;
    if (operacion) texto += " " + operacion;
    if (num2) texto += " " + num2;
    document.querySelector(".display").innerText = texto || "0";
}

/* Limpia todo */
function limpiar() {
    num1 = "";
    num2 = "";
    operacion = "";
    segundo = false;
    actualizarPantalla();
}

/* Borra √∫ltimo d√≠gito */
function borrar() {
    if (segundo) {
        num2 = num2.slice(0, -1);
    } else {
        num1 = num1.slice(0, -1);
    }
    actualizarPantalla();
}

/* Env√≠a operaci√≥n al backend */
function calcular() {
    document.getElementById("num1").value = num1;
    document.getElementById("num2").value = num2;
    document.getElementById("operacion").value = operacion;
    document.getElementById("calc-form").submit();
}

/* Operaciones cient√≠ficas */
function cientifica(op) {
    document.getElementById("num1").value = num1 || 0;
    document.getElementById("num2").value = 0;
    document.getElementById("operacion").value = op;
    document.getElementById("calc-form").submit();
}


/* =====================================================
   üìú SIDEBAR HISTORIAL
===================================================== */

/* Abrir historial */
function abrirHistorial() {
    document.getElementById("historialSidebar").classList.add("activo");
}

/* Cerrar historial */
function cerrarHistorial() {
    document.getElementById("historialSidebar").classList.remove("activo");
}

/* Cerrar si se hace click fuera */
document.addEventListener("click", function(event) {
    const sidebar = document.getElementById("historialSidebar");
    const boton = document.querySelector(".btn-historial");

    if (
        sidebar.classList.contains("activo") &&
        !sidebar.contains(event.target) &&
        !boton.contains(event.target)
    ) {
        cerrarHistorial();
    }
});


/* =====================================================
   üîê MODALES LOGIN / REGISTER
===================================================== */

function abrirLogin() {
    document.getElementById("loginModal").classList.remove("oculto");
}

function abrirRegister() {
    document.getElementById("registerModal").classList.remove("oculto");
}

function cerrarModal() {
    document.getElementById("loginModal").classList.add("oculto");
    document.getElementById("registerModal").classList.add("oculto");
}

</script>

</body>
</html>